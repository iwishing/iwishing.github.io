<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Blog|我所希冀的未来</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="大数据学习–zookeeper  环境：zookeeper：3.4.8系统：centos 6.7   1.zookeeper简介a.简介zookeeper是一个分布式协调服务,是给用户的分布式应用程序提供协调服务的，他的服务目标是分布式程序zookeeper本身就是一个分布式程序，只要有半数以上的节点存活，zk就能正常运行zookeeper所提供的服务有：主从协调、服务器节点动态上下线、统一配置管">
<meta property="og:type" content="article">
<meta property="og:title" content="Blog|我所希冀的未来">
<meta property="og:url" content="https://github.com/iwishing/myBlog.git/2019/04/18/大数据学习--zookeeper/index.html">
<meta property="og:site_name" content="Blog|我所希冀的未来">
<meta property="og:description" content="大数据学习–zookeeper  环境：zookeeper：3.4.8系统：centos 6.7   1.zookeeper简介a.简介zookeeper是一个分布式协调服务,是给用户的分布式应用程序提供协调服务的，他的服务目标是分布式程序zookeeper本身就是一个分布式程序，只要有半数以上的节点存活，zk就能正常运行zookeeper所提供的服务有：主从协调、服务器节点动态上下线、统一配置管">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412030737237.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411043446357.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411043919117.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050411254.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050511388.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050252384.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050157588.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050320751.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034148480.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034346518.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034724869.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035421447.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035705710.png">
<meta property="og:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035728242.png">
<meta property="og:updated_time" content="2019-04-18T14:21:36.110Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog|我所希冀的未来">
<meta name="twitter:description" content="大数据学习–zookeeper  环境：zookeeper：3.4.8系统：centos 6.7   1.zookeeper简介a.简介zookeeper是一个分布式协调服务,是给用户的分布式应用程序提供协调服务的，他的服务目标是分布式程序zookeeper本身就是一个分布式程序，只要有半数以上的节点存活，zk就能正常运行zookeeper所提供的服务有：主从协调、服务器节点动态上下线、统一配置管">
<meta name="twitter:image" content="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412030737237.png">
  
    <link rel="alternate" href="/atom.xml" title="Blog|我所希冀的未来" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Blog|我所希冀的未来</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/iwishing/myBlog.git"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-大数据学习--zookeeper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/18/大数据学习--zookeeper/" class="article-date">
  <time datetime="2019-04-18T14:03:37.546Z" itemprop="datePublished">2019-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="大数据学习"><a href="#大数据学习" class="headerlink" title="大数据学习"></a>大数据学习</h1><h2 id="–zookeeper"><a href="#–zookeeper" class="headerlink" title="–zookeeper"></a>–zookeeper</h2><blockquote>
<blockquote>
<p>环境：<br>zookeeper：3.4.8<br>系统：centos 6.7</p>
</blockquote>
</blockquote>
<h3 id="1-zookeeper简介"><a href="#1-zookeeper简介" class="headerlink" title="1.zookeeper简介"></a>1.zookeeper简介</h3><h5 id="a-简介"><a href="#a-简介" class="headerlink" title="a.简介"></a>a.简介</h5><p>zookeeper是一个分布式协调服务,是给用户的分布式应用程序提供协调服务的，他的服务目标是分布式程序<br>zookeeper本身就是一个分布式程序，只要有半数以上的节点存活，zk就能正常运行<br>zookeeper所提供的服务有：主从协调、服务器节点动态上下线、统一配置管理、分布式共享锁、统一名称服务等等<br>zookeeper底层实质只提供两个服务：</p>
<ol>
<li>管理(存储，读取)用户程序提交的数据</li>
<li>为用户程序提供数据节点监听服务</li>
</ol>
<h5 id="b-角色描述"><a href="#b-角色描述" class="headerlink" title="b.角色描述"></a>b.角色描述</h5><ol>
<li>Leader：领导者，负责进行投票的发起和决议，更新系统状态</li>
<li>Learner：<ul>
<li>Follower：用于接受客户请求并向客户端返回结果，在选主过程参与投票</li>
<li>Observer：接受用户请求，将请求转发给leader节点，但不参与投票，只同步Leader的状态，增加这个角色目的是为了扩展系统，提高读取速度</li>
</ul>
</li>
<li>Client：请求发起方</li>
</ol>
<p>zookeeper采用的方式是写任意。通过增加机器，他的吞吐能力和响应能力扩展性非常好，而且，随着机器的增多吞吐能力肯定下降(这也是它建立Observer的原因)，而响应能力取决于具体实现方式，是延迟复制保持最终一致性，还是立即复制快速响应。</p>
<h5 id="c-特性"><a href="#c-特性" class="headerlink" title="c.特性"></a>c.特性</h5><ul>
<li>zookeeper：一个Leader，多个Follower相组成的集群</li>
<li>全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的</li>
<li>分布式读写：更新请求转发，由Leader实施</li>
<li>更新请求顺序执行：来自同一个client的更新请求按其发送顺序依次执行</li>
<li>数据更新原子性：一次数据更新要么成功，要么失败</li>
<li>实时性：在一定时间范围内，client能读到最新数据</li>
</ul>
<h6 id="Server三种状态"><a href="#Server三种状态" class="headerlink" title="Server三种状态"></a>Server三种状态</h6><p>每个server在工作过程中有三种状态：<br><strong>LOOKING</strong>：当前Server不知道Leader是谁，正在搜寻<br><strong>LEADING</strong>：当前Server即为选举出的Leader<br><strong>FOLLOWING</strong>：leader已经选举出来，当前Server与之同步</p>
<h6 id="zookeeper选举流程"><a href="#zookeeper选举流程" class="headerlink" title="zookeeper选举流程"></a>zookeeper选举流程</h6><p>leader崩溃或者失去大多数follower时，zk进入恢复模式，重新选举出一个新的leader，让所有的server都恢复到一个正确的状态。zk的选举算法有两个：</p>
<ul>
<li>基于basic paxos算法实现</li>
<li>基于fast paxos算法实现</li>
</ul>
<p>系统默认的选举算法为fast paxos算法。</p>
<h5 id="d-zookeeper数据结构"><a href="#d-zookeeper数据结构" class="headerlink" title="d.zookeeper数据结构"></a>d.zookeeper数据结构</h5><p><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412030737237.png" alt></p>
<ul>
<li>层次化的目录结构，命名符合常规文件系统规范</li>
<li>每个节点在zookeeper中叫做znode，并且其有一个唯一的路径标识</li>
<li>节点Znode可以包含数据和子节点(ephemeral类型节点不能有子节点)</li>
<li>客户端应用可以在节点上设置监视器<blockquote>
<blockquote>
<p>监视器：客户端可以在节点上设置watch，我们叫监视器，当节点状态发生改变的时候，如数据的增、删、改，将会触发监视器，这是，zk会向客户端发送且仅发送一条通知，因为watch只能触发一次，触发后就被销毁了<br>Znode有两种类型</p>
<ul>
<li>短暂(ephemeral):server断开连接时自己删除</li>
<li>持久(persistent)server断开连接不删除</li>
</ul>
<p>Znode有四种形式的目录节点(默认是persistent)</p>
<ul>
<li>PERSISTENT</li>
<li>PERSISTENT_SEQUENTIAL(持久序列/test0000000019)</li>
<li>EPHENERAL</li>
<li>EPHENERAL_SEQUENTIAL<br>创建znode时设置顺序标识，znode名称后会附加一个值，顺序号是一个单调递增的计数器，由父节点维护。在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
<hr>
<h3 id="2-zookeeper的安装与配置"><a href="#2-zookeeper的安装与配置" class="headerlink" title="2.zookeeper的安装与配置"></a>2.zookeeper的安装与配置</h3><p><a href="http://archive.apache.org/dist/zookeeper/" target="_blank" rel="noopener">zookeeper下载地址</a><br>我们下载zookeeper-3.4.8<br>上传，解压到/usr/目录<br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411043446357.png" alt><br><strong>配置</strong><br>首先配置环境变量<br><code>vim /etc/profile</code><br>我们在文件尾加上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ZOOKEEPER_HOME=/usr/zookeeper-3.4.8</span><br><span class="line">export PATH=$PATH:$ZOOKEEPER/bin</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411043919117.png" alt><br>然后别忘了<code>source /etc/profile</code><br>然后我们需要配置/zookeeper-3.4.8/conf/zoo.cfg文件<br><code>vim /usr/zookeeper-3.4.8/conf/zoo.cfg</code><br>我们在文件末加入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir= /usr/zookeeper-3.4.8/data</span><br><span class="line">dataLogDir= /usr/zookeeper-3.4.8/log</span><br><span class="line">server.1=cbw:2888:3888</span><br><span class="line">server.2=cbw1:2888:3888</span><br><span class="line">server.3=cbw2:2888:3888</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050411254.png" alt><br>dataDir有时候zookeeper自带，我们就不需要加，我们加上后面的就行<br><strong><em>注意：cbw：主机名，2888：心跳端口，3888数据端口</em></strong><br>我们只需要修改主机名就行，然后<strong>server.x</strong>这个<strong>x</strong>表示你有多少台服务器，比如我有<strong>3</strong>台，我就要写到<strong>server.3</strong>，然后每个后面的主机名都要改成那台服务器的主机名。<br>之后，我们需要到/usr/zookeeper-3.4.8/目录下创建data和log这两个文件夹，有时候zookeeper自带了data，那么我们只需要创建log文件夹就行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -m 755 data</span><br><span class="line">mkdir -m 755 log</span><br></pre></td></tr></table></figure></p>
<p>然后我们在data目录下创建myid文件,并向其中写入<strong>1</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch myid</span><br><span class="line">vim myid</span><br></pre></td></tr></table></figure></p>
<p><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050511388.png" alt><br>最后一步，分发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/profile cbw1:/etc</span><br><span class="line">scp -r /usr/zookeeper-3.4.8 cbw1:/usr</span><br></pre></td></tr></table></figure></p>
<p>然后到cbw1这台机上<br><code>source /etc/profile</code><br>并且修改<strong>myid</strong>文件<br><code>vim /usr/zookeeper-3.4.8/data/myid</code><br>修改内容为2，因为我们在zoo.cfg中写的，cbw1对应的是server.2<br>同理cbw2也是要这样写，这样我们zookeeper集群就搭建完毕</p>
<h3 id="3-zookeeper命令"><a href="#3-zookeeper命令" class="headerlink" title="3.zookeeper命令"></a>3.zookeeper命令</h3><p>启动zookeeper服务<br><code>zkServer.sh start</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050252384.png" alt><br>查看zookeeper状态<br><code>zkServer.sh status</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050157588.png" alt><br>停止zookeeper服务<br><code>zkServer.sh stop</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190411050320751.png" alt><br>连接<br><code>zkCli.sh</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034148480.png" alt><br>Create命令<br><code>create [-e] [-s] path data acl</code></p>
<ul>
<li>path指定节点路径</li>
<li>data指定需要存放的数据(状态信息)<br>创建临时节点<br><code>create -e</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034346518.png" alt><br><strong><em>注意：临时节点是不能有子节点的</em></strong><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412034724869.png" alt><br>创建永久节点<br><code>create /zk_test data</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035421447.png" alt><br>创建临时有序节点<br><code>create -e -s /zk_test data</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035705710.png" alt><br>创建永久有序节点<br><code>create -s /zk_test data</code><br><img src="https://cbw-1258890494.cos.ap-chengdu.myqcloud.com/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0--zookeeper/20190412035728242.png" alt><br>删除节点<br><code>delete /zk_test</code><br><code>rmr /zk_test</code><br><strong><em>注意：delete不能删除节点下不为空的节点，而rmr可以递归删除</em></strong><br>我们在永久的节点下面创建有序永久节点，如果我们之前在/zk_test下面有3个临时的有序节点，之后客户端断开之后被删除，这个时候你再这个节点创建有序节点的时候，编号不是从0开始，而是从你之前的序号之后开始递增。<h3 id="4-zookeeper-ACL"><a href="#4-zookeeper-ACL" class="headerlink" title="4.zookeeper ACL"></a>4.zookeeper ACL</h3></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/iwishing/myBlog.git/2019/04/18/大数据学习--zookeeper/" data-id="cjumrrnlc000fkktf59m2al8i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/04/18/大数据学习--小实验/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/04/18/大数据学习--MapReduce程序编写/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/18/小科普/为什么判断闰年不能单单看这一年是否为4的倍数/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/18/大数据学习--小实验/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/18/大数据学习--zookeeper/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/18/大数据学习--MapReduce程序编写/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/18/大数据学习--idea与maven的安装与配置/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Iwishing<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>